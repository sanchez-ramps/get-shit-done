---
phase: 02-push-sync
plan: 04
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - commands/gsd/execute-phase.md
autonomous: true

must_haves:
  truths:
    - "Feature branch created when execute-phase starts"
    - "Branch name follows pattern: feature/PROJ-123-phase-name"
    - "Existing branch checked out silently"
    - "Branch creation uses Jira key from sync-state"
  artifacts:
    - path: "commands/gsd/execute-phase.md"
      provides: "Execute phase command with branch creation"
      contains: "feature branch"
  key_links:
    - from: "commands/gsd/execute-phase.md"
      to: ".planning/jira/sync-state.yaml"
      via: "read jiraKey for branch name"
      pattern: "sync-state"
---

<objective>
Add automatic feature branch creation with Jira issue key to the execute-phase command.

Purpose: Per CONTEXT.md, branches are created on execute-phase with naming convention feature/PROJ-123-phase-name.

Output: Modified execute-phase.md with git branch creation logic.
</objective>

<execution_context>
@/home/vedmahadeo/projects/get-shit-done/get-shit-done/workflows/execute-plan.md
@/home/vedmahadeo/projects/get-shit-done/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-push-sync/02-CONTEXT.md
@.planning/phases/02-push-sync/02-RESEARCH.md
@commands/gsd/execute-phase.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add feature branch creation to execute-phase</name>
  <files>commands/gsd/execute-phase.md</files>
  <action>
Read and modify commands/gsd/execute-phase.md to add branch creation:

1. Add Jira branch section (early in execution flow, before plan execution)

## Feature Branch Creation (if configured)

Before executing plans, create/checkout feature branch with Jira key.

### Step 1: Check if branch creation enabled
- Read .planning/jira/config.yaml
- Check sync.branchOnExecute setting
- If false or config missing: skip branch creation

### Step 2: Get Jira key for phase
- Read .planning/jira/sync-state.yaml
- Look up phase in entities.phases[phase-id]
- Get jiraKey (e.g., PROJ-45)

If no jiraKey:
- Phase not synced to Jira
- Warn user and create branch without Jira key

### Step 3: Construct branch name
Sanitize phase name for git:
- lowercase
- replace invalid chars with hyphen
- collapse multiple hyphens

Result: feature/PROJ-45-push-sync

### Step 4: Check if branch exists
If exists: checkout silently
If not exists: create and checkout

### Step 5: Verify working directory clean
Check git status before switching branches

### Step 6: Handle errors
- Branch name invalid: show sanitized alternative
- Git not initialized: skip branch creation

2. Integration point: This section runs BEFORE any plan execution begins.
  </action>
  <verify>
commands/gsd/execute-phase.md contains:
- Feature branch creation section
- Config check for sync.branchOnExecute
- Jira key lookup from sync-state.yaml
- Branch name sanitization logic
- Git branch/checkout commands
  </verify>
  <done>
execute-phase.md has branch creation logic that creates feature/PROJ-123-phase-name branches.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add branch status to phase execution output</name>
  <files>commands/gsd/execute-phase.md</files>
  <action>
Enhance execute-phase.md with branch context display:

1. Branch context header (shown at start of execution):

Phase: 02-push-sync
Branch: feature/PROJ-45-push-sync
Jira Epic: PROJ-45 with link
Plans: 4 total

2. End of phase branch handling:

After all plans complete, show branch status:
- Branch name
- Commits count
- Changed files count
- Next steps (verify, create PR)

3. No Jira case:
If Jira not configured:
- Check if on main/master
- Warn if executing on main
- Create branch without Jira key

4. Config options:
sync.branchOnExecute: true/false
sync.branchPrefix: feature/ (default)
  </action>
  <verify>
execute-phase.md includes:
- Execution context header with branch info
- End of phase branch status summary
- Next steps including verify and PR creation
- No-Jira fallback handling
  </verify>
  <done>
execute-phase.md shows branch context throughout execution and provides merge-ready summary.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. execute-phase.md has feature branch creation section
2. Branch created before plan execution starts
3. Branch name: feature/jiraKey-sanitized-phase-name
4. Existing branch checkout handled silently
5. Branch context shown in execution header
6. End summary includes branch status and next steps
</verification>

<success_criteria>
- [ ] execute-phase.md modified with branch creation
- [ ] Config check for sync.branchOnExecute
- [ ] Jira key read from sync-state.yaml
- [ ] Branch name sanitization for git compatibility
- [ ] Existing branch checkout (not error)
- [ ] Execution context header with branch info
- [ ] End summary with commit count and next steps
- [ ] Fallback for no-Jira case
</success_criteria>

<output>
After completion, create .planning/phases/02-push-sync/02-04-SUMMARY.md
</output>
